<section class='container mx-auto px-4 py-8 color-{{ section.settings.color_scheme }}'>
	<h1 class='text-3xl font-bold mb-4 text-primary'>{{ collection.title }}</h1>

	{% if collection.description != blank %}
		<div class='text-subdued mb-8'>
			{{ collection.description }}
		</div>
	{% endif %}

	<div class='grid grid-cols-1 md:grid-cols-4 gap-8'>
		<!-- Sidebar -->
		<aside class='md:col-span-1 space-y-6'>
			{% if collection.filters == empty %}
				<div class='bg-yellow-100 border border-yellow-300 text-yellow-800 text-sm rounded p-4 mb-4'>
					⚠️ <strong>Filters are not active</strong><br>
					To enable faceted filtering, please install and configure the
					<a
						href='https://apps.shopify.com/search-and-discovery'
						class='underline font-medium'
						target='_blank'
						>Shopify Search & Discovery</a
					>
					app.
				</div>
			{% endif %}

			<form method='get' id='collection-filters' class='space-y-6'>
				{% for filter in collection.filters %}
					<fieldset class='border-b pb-4'>
						<legend class='font-semibold mb-2 block text-gray-800'>
							{{ filter.label }}
						</legend>

						{% if filter.type == 'list' %}
							{% for value in filter.values %}
								<label class='flex items-center space-x-2 mb-1'>
									<input
										type='checkbox'
										name='{{ filter.param_name }}'
										value='{{ value.value }}'
										{% if value.active %}
											checked
										{% endif %}
										{% if value.count == 0 and value.active == false %}
											disabled
										{% endif %}
										class='border-gray-300'
									>
									<span>{{ value.label }} ({{ value.count }})</span>
								</label>
							{% endfor %}
						{% elsif filter.type == 'price_range' %}
							<div>
								<label class='block text-sm font-medium mb-1'>Price Range</label>
								<div class='flex items-center space-x-2'>
									<span>₱</span>
									<input
										type='number'
										name='{{ filter.min_value.param_name }}'
										min='{{ filter.min_value.min }}'
										max='{{ filter.min_value.max }}'
										value='{{ filter.min_value.value | default: filter.min_value.min }}'
										class='border px-2 py-1 w-24 rounded'
									>
									<span>to ₱</span>
									<input
										type='number'
										name='{{ filter.max_value.param_name }}'
										min='{{ filter.max_value.min }}'
										max='{{ filter.max_value.max }}'
										value='{{ filter.max_value.value | default: filter.max_value.max }}'
										class='border px-2 py-1 w-24 rounded'
									>
								</div>
							</div>
						{% endif %}
					</fieldset>
				{% endfor %}

				<button
					type='submit'
					class='w-full bg-[var(--color-button)] text-[var(--color-button-label)] px-4 py-2 rounded mt-4'
				>
					Apply Filters
				</button>
				<pre class='text-xs text-gray-500'>
  {{ collection.filters | json }}
</pre>
			</form>
		</aside>

		<!-- Product Grid -->
		<div class='md:col-span-3'>
			{% if collection.products_count > 0 %}
				{% paginate collection.products by section.settings.number_of_products_by_page %}
					<div class='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6'>
						{% for product in collection.products %}
							{% render 'product-card', product: product %}
						{% endfor %}
					</div>

					<div class='mt-10'>
						{% render 'pagination', pagination: paginate %}
					</div>
				{% endpaginate %}
			{% else %}
				<p class='text-subdued'>No products found in this collection.</p>
			{% endif %}
		</div>
	</div>
</section>

{% schema %}
{
	"name": "Collection Page Section",
	"settings": [
		{
			"type": "range",
			"id": "number_of_products_by_page",
			"label": "Number of products by name",
			"default": 9,
			"min": 6,
			"max": 24,
			"step": 3
		},
		{
			"type": "color_scheme",
			"id": "color_scheme",
			"label": "Color scheme",
			"default": "scheme-1"
		}
	],
	"presets": [
		{
			"name": "Collection Page"
		}
	]
}
{% endschema %}
