<section class='max-w-7xl mx-auto px-4 py-8 color-{{ section.settings.color_scheme }}'>
	{% if product %}
		<div class='grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch min-h-[450px]'>
			{% if product.media.size > 0 %}
				<!-- Media Viewer -->
				<media-viewer>
					<div class='swiper main-swiper w-full h-96  overflow-hidden'>
						<div class='swiper-wrapper flex space-x-4 w-max'>
							{% for media in product.media %}
								<div class='swiper-slide flex-shrink-0 w-full h-96 snap-start m-0 cursor-pointer'>
									{% case media.media_type %}
										{% when 'image' %}
											<img
												src='{{ media | image_url: width: 800 }}'
												alt='{{ media.alt | escape }}'
												class='w-full h-full object-cover'
											>

										{% when 'video' %}
											{{
												media
												| video_tag:
													class: 'w-full h-full object-cover',
													autoplay: true,
													controls: true
											}}
										{% when 'external_video' %}
											{% if media.host == 'youtube' %}
												<iframe
													class='w-full h-full object-cover'
													src='https://www.youtube.com/embed/{{ media.external_id }}?autoplay=1&mute=1&playsinline=1'
													frameborder='0'
													allow='autoplay; encrypted-media'
													allowfullscreen
												></iframe>

											{% elsif media.host == 'vimeo' %}
												<iframe
													class='w-full h-full object-cover'
													src='https://player.vimeo.com/video/{{ media.external_id }}?autoplay=1&muted=1&playsinline=1'
													frameborder='0'
													allow='autoplay; fullscreen'
													allowfullscreen
												></iframe>

											{% else %}
												{% comment %}
													Fallback: unknown video host (e.g., Wistia, self-hosted, or unsupported)
													Shopify may still output a working embed with media | external_video_tag
												{% endcomment %}
												{{
													media
													| external_video_tag:
														class: 'w-full h-full object-cover',
														autoplay: true
												}}
											{% endif %}

										{% else %}
											<img
												src='{{ 'logo.png' | asset_url }}'
												alt='Default fallback'
												class='w-full h-full object-cover'
											>
									{% endcase %}
								</div>
							{% endfor %}
						</div>
					</div>
					<!-- Thumbs Swiper -->
					<div class='swiper thumbs-swiper w-full h-24  overflow-hidden'>
						<div class='swiper-wrapper  flex space-x-4 w-max'>
							{% for media in product.media %}
								<div class='swiper-slide w-24 h-24 flex-shrink-0  snap-start m-1 first:ml-0 mr-0 cursor-pointer'>
									{% case media.media_type %}
										{% when 'image' %}
											<img
												src='{{ media | image_url: width: 200 }}'
												alt='thumb'
												class='w-full h-full object-cover'
											>
										{% when 'video' %}
											{{
												media
												| video_tag:
													class: 'w-full h-full object-cover',
													autoplay: false,
													muted: true
											}}
										{% when 'external_video' %}
											{{ media | external_video_tag: class: 'w-full h-full object-cover' }}
										{% else %}
											<img
												src='{{ 'logo.png' | asset_url }}'
												alt='Fallback'
												class='w-full h-full object-cover'
											>
									{% endcase %}
								</div>
							{% endfor %}
						</div>
					</div>
				</media-viewer>
			{% else %}
				<div class='flex-shrink-0 w-full h-96 snap-start m-0 cursor-pointer'>
					<div class='w-full h-full flex items-center justify-center'>
						{% if shop.logo %}
							<img
								src='{{ shop.logo | image_url: width: 800 }}'
								alt='{{ shop.name | escape }} logo'
								class='max-h-full max-w-full object-contain'
							>
						{% else %}
							<img
								src='{{ 'logo.png' | asset_url }}'
								alt='Fallback logo'
								class='max-h-full max-w-full object-contain'
							>
						{% endif %}
					</div>
				</div>
			{% endif %}

			<!-- Product Info + Form -->
			<product-info
				data-variants='{{ product.variants | json | escape }}'
				id='product-info'
				class='flex flex-col h-full'
			>
				{% form 'product', product %}
					<div class='flex flex-col justify-between h-full'>
						<div>
							<div class='my-3'>
								<span class='text-xs text-gray-500'>{{ product.vendor }}</span>
							</div>
							<div class='my-3'>
								<h1 class='text-3xl font-bold text-primary mb-2'>{{ product.title }}</h1>
							</div>
							<div class='my-3'>
								<span id='compareAtPrice' class='text-xl text-secondary mb-4 line-through'>
									{{ product.selected_or_first_available_variant.compare_at_price | money }}
								</span>
								<span id='regularPrice' class='text-xl text-secondary font-bold mb-4'>
									{{ product.selected_or_first_available_variant.price | money }}
								</span>
								{% if product.selected_or_first_available_variant.price
										< product.selected_or_first_available_variant.compare_at_price
								%}
									<span
										id='saleBadge'
										class='px-5 py-1 text-sm font-bold bg-red-500 rounded-full text-white mx-4'
									>
										Sale
									</span>
								{% else %}
									<span id='saleBadge' class='hidden'></span>
								{% endif %}
							</div>

							<div class='my-3 space-y-4'>
								{% unless product.has_only_default_variant %}
									{% for option in product.options_with_values %}
										<div class='mb-4'>
											<span class='block text-sm font-semibold mb-2'>{{ option.name }}</span>
											<div class='grid grid-cols-4 sm:grid-cols-6 gap-2'>
												{% for value in option.values %}
													{% assign is_checked = false %}
													{% if forloop.first %}
														{% assign is_checked = true %}
													{% endif %}

													<label class='cursor-pointer block'>
														<input
															type='radio'
															name='options[{{ option.name }}]'
															value='{{ value }}'
															class='sr-only'
															{% if forloop.first %}
																checked
															{% endif %}
														>

														{% assign is_checked = forloop.first %}
														{% assign base_classes = 'text-sm hover:opacity-90 transition text-center border' %}

														<span
															class='
																variant-button
																{% if option.name == "Color" %}
																  h-10 flex items-center justify-center px-4 rounded
																{% else %}
																  px-4 py-2 rounded block
																{% endif %}
																{{ base_classes }}
															'
															data-name='options[{{ option.name }}]'
															data-value='{{ value }}'
															data-selected='{{ is_checked }}'
														>
															{{ value }}
														</span>
													</label>
												{% endfor %}
											</div>
										</div>
									{% endfor %}
								{% endunless %}
							</div>

							<input type='hidden' name='id' value='{{ product.selected_or_first_available_variant.id }}'>
						</div>

						<div class='mt-auto space-y-3 pt-4'>
							<div id='purchaseActions' class='space-y-3'>
								<button
									id='addToCartBtn'
									type='submit'
									name='add'
									class='w-full bg-[var(--color-button)] text-[var(--color-button-label)] font-semibold py-3 rounded hover:bg-opacity-90 transition'
								>
									Add to Cart
								</button>
								{{ form | payment_button }}
							</div>

							<div
								id='soldOutMessage'
								class='h-[100px] flex items-center justify-center text-red-600 font-bold text-center bg-gray-100 rounded'
							>
								SOLD OUT
							</div>
						</div>
					</div>
				{% endform %}
			</product-info>
		</div>

		<div class='mt-12 prose prose-sm md:prose lg:prose-lg max-w-none text-gray-800'>
			{{ product.description }}
		</div>

	{% else %}
		<p class='text-subdued'>No product found.</p>
	{% endif %}
</section>

{% schema %}
{
	"name": "Product Section",
	"settings": [
		{
			"type": "color_scheme",
			"id": "color_scheme",
			"label": "Color scheme",
			"default": "scheme-1"
		}
	],
	"presets": [
		{
			"name": "Default Product"
		}
	]
}
{% endschema %}
